<!DOCTYPE html>

<html lang="en">
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

<head>
    <meta charset="UTF-8">

    {# font #}
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
          rel="stylesheet">

    {# vuetify #}
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">

    {# buefy #}
    <link rel="stylesheet" href="https://unpkg.com/buefy/dist/buefy.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <style type="text/css">
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        #app {
            max-width: 520px;
            margin: 0px auto;
            padding-bottom: 0px;
            color: #222222;
        }

        .app-container {
            padding-top: 30px;
            padding-left: 20px;
            padding-right: 20px;
            letter-spacing: -0.3px;
        }

        .form-container {
            padding-bottom: 10px;
        }

        .form-date {
            margin-top: 13px;
        }

        .form-button {
            margin-top: 13px;
        }


        .nav1 {
            padding: 20px;
        }

        .form-element {
            padding-top: 0;
            padding-bottom: 0;
        }

        .calculate-button {
            margin-right: 12px;
        }

        .destination {
            padding-top: 20px;
            padding-left: 15px;
            padding-bottom: 15px;
        }

        .destination-value {
            color: #FF6F00;
        }

        .result-info-title {
            color: #222222;
            font-size: 1.6em;
            margin-top: 15px;
            margin-bottom: 6px;
        }

        .result-info-schedule {
        }

        .result-info-price-each {
            padding-left: 5px;
            font-weight: bold;
            color: #222222;
        }

        .result-info-price-tag {
            padding-left: 4px;
            font-weight: lighter;
            color: #222222;
        }


        .result-total-text-price {
            color: #3EC487;
            font-size: 2em;
            font-weight: bold;
        }


        .result-total-detail-button {

        }

    </style>

</head>
<body>
<div id="app">
    <nav class="nav1">
        <img src="https://cdn-icons-png.flaticon.com/512/59/59576.png" width="50" height="50" aria-hidden="false">
        travel <b>calculator</b>
    </nav>
    <div class="app-container">
        <v-app>
            <v-main>
                <div class="form-container">
                    <div class="form-destination">
                        <b-field>
                            <b-select placeholder="어디로 떠나볼까요?" expanded icon="earth" v-model="city_code">
                                <option value="LHR">런던</option>
                                {# TODO: 이상하게 v-for 가 제대로 노출되지 않음... 추후 보완할것 #}
                                <option value="CDG">파리</option>
                                <option value="HND">도쿄</option>
                                <option value="GUM">괌</option>
                                <option value="JFK">뉴욕</option>
                            </b-select>
                        </b-field>

                    </div>
                    <div class="form-date">
                        <template>
                            <b-field>
                                <b-datepicker
                                        placeholder="여행 일정을 선택해주세요"
                                        icon="calendar"
                                        v-model="dates"
                                        range>
                                </b-datepicker>
                            </b-field>
                        </template>
                    </div>
                    <div class="form-button">
                        <b-button type="is-success" expanded style="height:44px" :loading="loading" @click="postCalculate">계산하기</b-button>
                    </div>
                </div>
                <div class="result-container">
                    <v-card
                            :loading="loading"
                            class="mx-auto my-12"
                            max-width="600"
                    >
                        <template slot="progress">
                            <v-progress-linear
                                    color="deep-purple"
                                    height="10"
                                    indeterminate
                            ></v-progress-linear>
                        </template>

                        <v-img
                                height="250"
                                height="250"
                                {#                                src="https://images.unsplash.com/photo-1533219346979-3030e2810f5b?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=879&q=80"#}
                                :src="result.image"
                        ></v-img>

                        {#                        <v-card-title>#}
                        {#                            <v-icon color="yellow darken-3" medium>mdi-star-circle</v-icon><span style="padding-right: 8px"></span>{{ '페루' }}#}
                        {#                            페루#}
                        {#                        </v-card-title>#}
                        <v-card-text>
                            <div class="result-info-title">[[ result.city_name ]]</div>
                            <div class="result-info-schedule">
                                출발 [[ result.from_date ]] | 도착 [[ result.to_date ]]
                            </div>
                            <v-card-text>
                                <div class="my-4 text-subtitle-1">
                                    <v-icon color="yellow darken-3" small>mdi-airplane</v-icon>
                                    <span class="result-info-price-tag">항공권</span><span class="result-info-price-each">[[ result.flight_expense.toLocaleString()]] 원</span>
                                </div>

                                <div class="my-4 text-subtitle-1">
                                    <v-icon color="yellow darken-3" small>mdi-bed</v-icon>
                                    <span class="result-info-price-tag">숙박비</span>
                                    <span class="result-info-price-each">[[ result.hotel_expense.toLocaleString()]] 원</span>
                                </div>

                                <div class="my-4 text-subtitle-1">
                                    <v-icon color="yellow darken-3" small>mdi-food-fork-drink</v-icon>
                                    <span class="result-info-price-tag">식비</span>
                                    <span class="result-info-price-each">[[ result.meal_expense.toLocaleString()]] 원</span>
                                </div>
                            </v-card-text>

                            <div style="padding-top: 10px;">
                                [[ result.from_date ]]에 출발하는 [[ result.city_name ]]행 [[ result.nights ]]박
                                [[result.days]]일 여행의
                                항공권 가격은 [[ result.flight_expense.toLocaleString()]] 원,
                                숙박비는 [[ result.hotel_expense.toLocaleString()]] 원,
                                식비는 [[ result.meal_expense.toLocaleString()]] 원으로 예상되어요.
                            </div>
                            <div></div>
                        </v-card-text>

                        <v-divider class="mx-4"></v-divider>

                        <v-card-title>총 예상 경비</v-card-title>

                        <v-card-text style="padding-bottom: 50px">
                            <span class="result-total-text-price">[[ result.total_expense.toLocaleString() ]]</span>
                            <span class="result-total-text-unit"> 원 ([[result.traveler_count]] 인 기준)</span>
                        </v-card-text>
                    </v-card>
                </div>
            </v-main>
        </v-app>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<script src="https://unpkg.com/buefy/dist/buefy.min.js"></script>


<script>
    {# utils #}
    const formatMonth = (month) => {
        month += 1;
        return month < 10 ? `0${month}` : `${month}`;
    };

    const formatDate = (date) => {
        return date < 10 ? `0${date}` : `${date}`;
    };

    const formatDatetime = (datetime) => {
        return `${datetime.getFullYear()}-${formatMonth(datetime.getMonth())}-${formatDate(datetime.getDate())}`
    };


    const now = new Date();

    new Vue({
        el: '#app',
        vuetify: new Vuetify(),
        delimiters: [
            '[[', ']]'],
        methods: {
            async postCalculate() {
                this.loading = true;

                const path = '../api/calculate/';
                const from_date = formatDatetime(this.dates[0]);
                const to_date = formatDatetime(this.dates[1]);
                const city_code = this.city_code;
                const payload = new URLSearchParams({from_date, to_date, city_code});

                const response = await fetch(`${path}?${payload}`, {
                    method: 'GET',
                    credentials: 'same-origin'
                });

                const { destination, flight_expense, hotel_expense, meal_expense, total_expense, nights, days, traveler_count } = await response.json();
                this.result.city_code = this.city_code;
                this.result.city_name = destination;
                this.result.from_date = from_date;
                this.result.to_date = to_date;
                this.result.flight_expense = flight_expense;
                this.result.hotel_expense = hotel_expense;
                this.result.meal_expense = meal_expense;
                this.result.total_expense = total_expense;
                this.result.nights = nights;
                this.result.days = days;
                this.result.traveler_count = traveler_count;

                // TODO: 이미지 추가
                this.result.image = 'https://images.unsplash.com/photo-1523216847009-1dbdf2ca6236?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=626&q=100.jpg'
                this.loading = false;
            }
        },
        watch: {
            loader() {
                const l = this.loader
                this[l] = !this[l]

                setTimeout(() => (this[l] = false), 3000)

                this.loader = null
            },
        },
        data: {
            city_code: null,
            loading: false,
            dates: [],
            menu: false,
            modal: false,
            menu2: false,
            menu3: false,
            destinations: [
                {name: '런던', code: 'LHR'},
                {name: '파리', code: 'CDG'},
                {name: '도쿄', code: 'HND'},
                {name: '괌', code: 'GUM'},
                {name: '뉴욕', code: 'JFK'},
            ],
            message: '가보자고!',
            result: {
                city_name: '라스베가스',
                city_code: 'LAX',
                image: 'https://images.unsplash.com/photo-1566310421012-827cd561e657?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=870&q=100.jpg',
                from_date: formatDatetime(now),
                to_date: formatDatetime(new Date(new Date().setDate(now.getDate() + 3))),
                flight_expense: 1351000,
                hotel_expense: 905000,
                meal_expense: 182000,
                total_expense: 2438000,
                nights: 3,
                days: 4,
                traveler_count: 1
            }
        }
    })
</script>
</body>
</html>